<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../assets/images/logo_semFundo.png" type="image/x-icon">
    <title>Cadastro</title>

    <!-- ---- CSS ---- -->
    <link rel="stylesheet" href="../../themes/global.css">
    <link rel="stylesheet" href="../styles/cadastro.css">
    <!-- ------------- -->

    <!-- ---- Sweet_Alert2 ---- -->
    <link rel="stylesheet" href="../libraries/Sweet_alert2/sweetalert2.css">
    <script src="../libraries/Sweet_alert2/sweetalert2.js"></script>
    <!-- ---------------------- -->
</head>
<body>
    <header>
        <h1>PROJETO</h1> <img src="../../assets/images/logo_semFundo.png" alt="logo" class="logo"> <h1>LYNCE</h1>
    </header>

    <div class="container">
        <h1>CADASTRO</h1>
        <form>
            <div class="grid">
                <div class="col">
                    <div class="inputBox">
                        <input type="text" name="nome" id="nome" required="required">
                        <span class="text" >Nome</span>
                        <span class="line" ></span>
                    </div>
                </div>
                <!-- <div class="col">
                    <div class="inputBox">
                        <input type="text" name="usuario" id="usuario" required="required" maxlength="50">
                        <span class="text" >Usuário</span>
                        <span class="line" ></span>
                    </div>
                </div> -->
                <div class="col">
                    <div class="inputBox">
                        <input type="email" name="email" id="email" required="required" maxlength="50">
                        <span class="text" >Email</span>
                        <span class="line" ></span>
                    </div>
                </div>
                <div class="col">
                    <div class="inputBox">
                        <input type="password" name="senha" id="senha" required="required" maxlength="40">
                        <span class="text" >Senha</span>
                        <span class="line" ></span>
                    </div>
                </div>
                <div class="col">
                    <div class="inputBox">
                        <input type="password" name="confSenha" id="confSenha" required="required" maxlength="40">
                        <span class="text" >Confirmar senha</span>
                        <div class="line" ></div>
                    </div>
                </div>
                <div class="col">
                    <div class="inputBox">
                        <select id="estado" name="estado">
                                <option hidden value="null">Estado</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amapá</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Ceará</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Espírito Santo</option>
                            <option value="GO">Goiás</option>
                            <option value="MA">Maranhão</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Pará</option>
                            <option value="PB">Paraíba</option>
                            <option value="PR">Paraná</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piauí</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rondônia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">São Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                    </div>
                </div>
                <div class="col">
                    <div class="inputBox">
                        <input type="text" name="cidade" id="cidade" required="required" maxlength="90">
                        <span class="text" >Cidade</span>
                        <span class="line" ></span>
                    </div>
                </div>
                <div class="col">
                    <div class="inputBox">
                        <input type="text" name="tel" id="tel" required="required" maxlength="14">
                        <span class="text" >Telefone/Celular</span>
                        <span class="line" ></span>
                    </div>
                </div>
                <div class="col">
                    <div class="inputBox btnRadio" >
                        <h5>Tipo de conta</h5>
                        <label for="">Técnico</label>
                        <input type="radio" name="tipo_conta" value="tecnico" class="radio tec">
                        <label for="">Usuário</label>
                        <input type="radio" name="tipo_conta" value="cliente" checked class="radio usu">
                    </div>
                </div>

                <div class="col tec_col" >
                    <div class="inputBox">
                        <input type="text" name="endereco" id="ende" maxlength="60" >
                        <span class="text" >Endereço</span>
                        <span class="line" ></span>
                    </div>
                </div>

                <div class="col tec_col" >
                    <div class="inputBox">
                        <input type="text" name="num_complementar" id="num_comp" maxlength="14">
                        <span class="text" >Número complementar</span>
                        <span class="line" ></span>
                    </div>
                </div>
            </div>
            <div class="contEnv">
                <input type="submit" value="CADASTRAR" >
                <h5>Já tem uma conta? <br> <a href="./index.html" class="link">Faça login!</a></h5>
            </div>
        </form>
    </div>

    <!-- ---------------- VLibras------------- -->
    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
          <div class="vw-plugin-top-wrapper"></div>
        </div>
      </div>
      <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
      <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
      </script>
    <!-- ---------------- VLibras------------- -->
    <script>
        let formulario = document.querySelector("form");
        let pswd = document.querySelector("#senha")
        let confPswd = document.querySelector("#confSenha")
        let line = document.querySelector(".inputBox > div")

        formulario.addEventListener("submit",(e)=>{
            e.preventDefault();

            if(pswd.value != confPswd.value){
                e.preventDefault();
                Swal.fire({
                        title: 'Oops!',
                        text: "Senhas diferentes",
                        icon: 'error',
                        confirmButtonText: "Tentar novamente"
                    })
                line.style.backgroundColor = "#FF2D2D";
                return false;
            }
            else {
                line.style.backgroundColor = "#2EFF81";

                const formData = new FormData(formulario)

                const url = "/server/php/cadastro.php";
                const options = {
                    method: "POST",
                    body: formData
                }
                
                fetch(url,options)
                .then(function(response) {
                    if (!response.ok) {
                        throw Error(response.statusText);
                    }
                    return response;
                })
                .then((res) => {
                    Swal.fire({
                        title: 'Sucesso!',
                        text: "Cadastro realizado com sucesso!",
                        icon: 'success',
                        confirmButtonText: "Ok"
                    }).then((isConfirmed) => {if(isConfirmed) location.href = './login.html'}) 
                                   
                })
                .catch((err) => {
                    // alert(error);
                    Swal.fire({
                        title: 'Oops!',
                        text: err,
                        icon: 'error',
                        confirmButtonText: "Tentar novamente"
                    })
                });
            }
        })

    </script>

    <script src="../libraries/Vanilla_masker/vanilla-masker.min.js"></script>

    <script>
        function inputHandler(masks, max, event) {
            let c = event.target;
            let v = c.value.replace(/\D/g, '');
            let m = c.value.length > max ? 1 : 0;
            VMasker(c).unMask();
            VMasker(c).maskPattern(masks[m]);
            c.value = VMasker.toPattern(v, masks[m]);
        }

        let telMask = ['(99) 9999-99999', '(99) 99999-9999'];
        let tel = document.querySelector('#tel');
        VMasker(tel).maskPattern(telMask[0]);
        tel.addEventListener('input', inputHandler.bind(undefined, telMask, 14), false);
    </script>

    

    <script>
        const tipos = document.querySelectorAll('input[name="tipo_conta"]')
        const tec_col = document.querySelectorAll(".tec_col")
        for (const tipo of tipos) {
            tipo.addEventListener("click",()=>{
                if (tipo.checked && (tipo.value == "tecnico")) {
                    for(const col of tec_col ) {
                        col.className = "col"
                    }
                } else if (tipo.checked && tipo.value == "usuario") {
                    for(const col of tec_col ) {
                        col.className = "tec_col"
                    }
                }
            })

            
        }
    </script>
</body>
</html>